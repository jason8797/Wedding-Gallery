<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Wedding Gallery</title>
    <script type="module">
      import React, { useState, useEffect, useRef } from "https://esm.sh/react";
      import { createRoot } from "https://esm.sh/react-dom/client";
      import { motion } from "https://esm.sh/framer-motion";
      import {
        Heart,
        Shuffle,
      } from "https://esm.sh/lucide-react";

      const PHOTOS_PER_PAGE = 20;
      const MAX_PHOTOS = 500;

      function WeddingGallery() {
        const [photos, setPhotos] = useState([]);
        const [favorites, setFavorites] = useState([]);
        const [searchTerm, setSearchTerm] = useState("");
        const [filteredPhotos, setFilteredPhotos] = useState([]);
        const [page, setPage] = useState(1);

        const loaderRef = useRef(null);

        // ÂàùÂßãÂåñËºâÂÖ• JPG + PNG
        useEffect(() => {
          const items = [];
          for (let i = 1; i <= MAX_PHOTOS; i++) {
            items.push({
              id: `jpg-${i}`,
              thumb: `/photos/thumb/photo${i}.jpg`,
              full: `/photos/full/photo${i}.jpg`,
            });
            items.push({
              id: `png-${i}`,
              thumb: `/photos/thumb/photo${i}.png`,
              full: `/photos/full/photo${i}.png`,
            });
          }
          setPhotos(items);
        }, []);

        // ÊêúÂ∞ãÈÅéÊøæ
        useEffect(() => {
          const filtered = photos.filter((p) =>
            p.full.toLowerCase().includes(searchTerm.toLowerCase())
          );
          setFilteredPhotos(filtered);
        }, [photos, searchTerm]);

        // Infinite Scroll Áõ£ËÅΩ
        useEffect(() => {
          const observer = new IntersectionObserver(
            (entries) => {
              if (entries[0].isIntersecting) {
                setPage((p) => p + 1);
              }
            },
            { threshold: 1 }
          );

          if (loaderRef.current) observer.observe(loaderRef.current);
          return () => observer.disconnect();
        }, []);

        // ÂèñÂá∫ÁõÆÂâçÊáâÈ°ØÁ§∫ÁöÑÁÖßÁâá
        const displayedPhotos = filteredPhotos.slice(0, page * PHOTOS_PER_PAGE);

        // Êî∂ËóèÂäüËÉΩ
        const toggleFavorite = (id) => {
          setFavorites((prev) =>
            prev.includes(id) ? prev.filter((f) => f !== id) : [...prev, id]
          );
        };

        // Èö®Ê©üÊéíÂàó
        const shufflePhotos = () => {
          setFilteredPhotos((prev) => [...prev].sort(() => Math.random() - 0.5));
        };

        return (
          <div className="min-h-screen bg-gradient-to-br from-pink-100 via-white to-blue-100 p-6">
            <div className="max-w-6xl mx-auto">
              <div className="flex justify-between items-center mb-6">
                <h1 className="text-3xl font-bold text-gray-700">
                  üíç Wedding Gallery
                </h1>

                <div className="flex gap-2">
                  <input
                    type="text"
                    placeholder="ÊêúÂ∞ãÁÖßÁâá..."
                    value={searchTerm}
                    onChange={(e) => setSearchTerm(e.target.value)}
                    className="border border-gray-300 rounded-xl px-3 py-2"
                  />
                  <button
                    onclick={shufflePhotos}
                    class="px-4 py-2 border rounded-xl bg-white shadow"
                  >
                    <Shuffle class="w-4 h-4 inline-block mr-1" /> Èö®Ê©üÊéíÂàó
                  </button>
                </div>
              </div>

              {/* ÁÄëÂ∏ÉÊµÅÁ∂≤Ê†º */}
              <motion.div layout className="grid grid-cols-2 md:grid-cols-4 gap-4">
                {displayedPhotos.map((photo) => (
                  <div
                    key={photo.id}
                    className="overflow-hidden shadow-lg relative group hover:scale-105 transition-transform rounded-2xl"
                  >
                    <img
                      src={photo.thumb}
                      alt={photo.id}
                      loading="lazy"
                      className="w-full h-48 object-cover"
                    />

                    <button
                      onClick={() => toggleFavorite(photo.id)}
                      className="absolute top-2 right-2 bg-white/80 rounded-full p-1"
                    >
                      <Heart
                        className={`w-5 h-5 ${
                          favorites.includes(photo.id)
                            ? "text-red-500 fill-red-500"
                            : "text-gray-400"
                        }`}
                      />
                    </button>
                  </div>
                ))}
              </motion.div>

              {/* Infinite Scroll Ëß∏ÁôºÂô® */}
              <div ref={loaderRef} className="h-16 flex justify-center items-center">
                <p className="text-gray-500">ËºâÂÖ•‰∏≠‚Ä¶</p>
              </div>
            </div>
          </div>
        );
      }

      const root = createRoot(document.getElementById("root"));
      root.render(<WeddingGallery />);
    </script>

    <script src="https://cdn.tailwindcss.com"></script>
  </head>

  <body class="bg-white">
    <div id="root"></div>
  </body>
</html>
